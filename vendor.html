<!doctype html> 
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Partner with ZomaClone — Vendor Access</title>
  <link rel="icon" type="image/png" sizes="512x512" href="Images/logo_512.png">

  <style>
    :root { --primary:#1674ff; --accent:#e23744; --muted:#6b7280; --card:#fff; }
    *{box-sizing:border-box}
    body{font-family:'Poppins',sans-serif;margin:0;background:#fafafa;color:#111}

    .nav{
      display:flex;justify-content:space-between;align-items:center;
      padding:18px 36px;background:#fff;
      box-shadow:0 1px 0 rgba(0,0,0,0.06)
    }
    .logo{font-weight:700;color:var(--accent)}

    .hero{
      min-height:420px;
      background-image:linear-gradient(rgba(0,0,0,.45),rgba(0,0,0,.45)),
      url('https://images.unsplash.com/photo-1600891964599-f61ba0e24092?auto=format&fit=crop&w=2100&q=80');
      background-size:cover;background-position:center;
      display:flex;align-items:center;justify-content:center;flex-direction:column;
      color:#fff;text-align:center;padding:90px 20px
    }
    .hero h1{font-size:34px;margin:0 0 14px;font-weight:700}

    .btn{
      background:var(--primary);color:#fff;border:none;
      padding:10px 16px;border-radius:8px;cursor:pointer;font-weight:600
    }
    .btn.ghost{
      background:transparent;color:var(--primary);
      border:1px solid rgba(22,116,255,.12)
    }

    .card-overlay{
      position:relative;margin-top:-70px;width:940px;max-width:92%;
      background:var(--card);border-radius:12px;padding:20px;
      box-shadow:0 12px 30px rgba(15,20,30,.12);display:flex;gap:18px;align-items:center
    }
    .card-left{flex:1}
    .card-right{flex:1}

    .features{padding:60px 20px}
    .feature{
      background:#fff;border-radius:10px;padding:22px;
      box-shadow:0 6px 18px rgba(20,30,50,.04);text-align:center
    }

    footer{
      padding:36px 20px;background:#fff;margin-top:40px;
      border-top:1px solid #eee;text-align:center;color:var(--muted)
    }

    .modal{
      display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);
      justify-content:center;align-items:center;z-index:999
    }
    .modal.show{display:flex}
    .modal-box{
      background:#fff;padding:22px;border-radius:10px;width:420px;max-width:94%;position:relative
    }
    .modal-box h2{text-align:center;margin:6px 0 14px}
    .modal-box input{
      width:100%;padding:10px;margin-bottom:10px;border:1px solid #ddd;
      border-radius:6px;font-size:14px
    }
    .close-btn{position:absolute;right:12px;top:8px;font-size:18px;cursor:pointer;color:#666}
    .error{color:#cc2b2b;text-align:center;display:none;margin-bottom:8px}
    .muted-note{margin-top:10px;font-size:13px;color:#555;text-align:center}
  </style>
</head>

<body>

  <!-- NAVIGATION -->
  <header class="nav">
    <div class="logo">ZomaClone</div>
    <div>
      <button class="btn ghost" id="partnerBtn" type="button">Partner with us</button>
      <button class="btn" id="openLoginBtn" type="button">Login</button>
    </div>
  </header>

  <!-- HERO -->
  <section class="hero">
    <h1>Partner with ZomaClone and grow your business</h1>
    <button class="btn" id="openRegisterBtn" type="button">Register your restaurant</button>
  </section>

  <!-- INFO CARD -->
  <div class="card-overlay">
    <div class="card-left">
      <h4>Get started: It only takes 10 minutes</h4>
      <ul style="margin:8px 0 0;padding-left:18px;color:var(--muted)">
        <li>PAN card</li>
        <li>FSSAI license</li>
        <li>Bank account details</li>
        <li>GST number (if applicable)</li>
        <li>Menu & food images</li>
      </ul>
    </div>
    <div class="card-right">
      <img src="https://images.unsplash.com/photo-1600891964599-f61ba0e24092?auto=format&fit=crop&w=800&q=60"
           style="width:100%;border-radius:8px;object-fit:cover;height:150px" alt="">
    </div>
  </div>

  <!-- FEATURES -->
  <main class="features">
    <div style="max-width:1100px;margin:0 auto;display:grid;grid-template-columns:repeat(3,1fr);gap:18px">
      <div class="feature"><h5>Attract new customers</h5><p style="color:var(--muted)">Reach more people ordering on ZomaClone.</p></div>
      <div class="feature"><h5>Doorstep delivery</h5><p style="color:var(--muted)">Easily get your orders delivered.</p></div>
      <div class="feature"><h5>Onboarding support</h5><p style="color:var(--muted)">Email merchantonboarding@zomaclone.com</p></div>
    </div>
  </main>

  <footer><div style="max-width:1100px;margin:0 auto">&copy; 2025 ZomaClone</div></footer>

  <!-- REGISTER MODAL -->
  <div class="modal" id="registerModal">
    <div class="modal-box">
      <span class="close-btn" id="closeRegisterBtn">&times;</span>
      <h2>Register Your Restaurant</h2>
      <div class="error" id="registerError"></div>

      <form id="registerForm">
        <input id="restaurantName" placeholder="Restaurant / Brand Name" required>
        <input id="ownerName" placeholder="Owner Name" required>
        <input id="registerAddress" placeholder="Full Address" required>
        <input id="registerEmail" type="email" placeholder="Email address" required>
        <input id="registerPhone" type="text" placeholder="Phone number (required)" required>
        <input id="registerPassword" type="password" placeholder="Password" required>
        <input id="registerConfirmPassword" type="password" placeholder="Confirm password" required>
        <button class="btn" type="submit">Send OTP</button>
      </form>

      <p class="muted-note">
        Already have an account?
        <button class="btn ghost" id="switchToLoginFromRegister" type="button">Login</button>
      </p>
    </div>
  </div>

  <!-- LOGIN MODAL (OTP only: email or phone) -->
  <div class="modal" id="loginModal">
    <div class="modal-box">
      <span class="close-btn" id="closeLoginBtn">&times;</span>
      <h2>Login with OTP</h2>
      <div class="error" id="loginError"></div>

      <form id="loginForm">
        <input id="loginIdentifier" placeholder="Email or Phone Number" required>
        <button class="btn" type="submit">Send OTP</button>
      </form>
    </div>
  </div>

  <!-- REGISTRATION OTP MODAL -->
  <div class="modal" id="otpModal">
    <div class="modal-box">
      <span class="close-btn" id="closeOtpBtn">&times;</span>
      <h2>Email Verification</h2>
      <p style="text-align:center;margin-bottom:8px;color:#444">
        Enter the 4-digit OTP sent to your email
      </p>

      <div class="error" id="otpError"></div>

      <input id="otpInput" type="text" placeholder="Enter OTP">
      <button class="btn" id="verifyOtpBtn" type="button">Verify OTP</button>
    </div>
  </div>

  <!-- LOGIN OTP MODAL -->
  <div class="modal" id="loginOtpModal">
    <div class="modal-box">
      <span class="close-btn" id="closeLoginOtpBtn">&times;</span>
      <h2>Verify Login OTP</h2>
      <p style="text-align:center;margin-bottom:8px;color:#444">
        Enter the OTP sent to your email or phone
      </p>
      <div class="error" id="loginOtpError"></div>
      <input id="loginOtpInput" type="text" placeholder="Enter OTP" maxlength="6">
      <button class="btn" id="verifyLoginOtpBtn" type="button">Verify OTP</button>
    </div>
  </div>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const API_BASE = "http://127.0.0.1:5000";

    // --------- MODAL ELEMENTS ----------
    const registerModal = document.getElementById("registerModal");
    const loginModal = document.getElementById("loginModal");
    const otpModal = document.getElementById("otpModal");
    const loginOtpModal = document.getElementById("loginOtpModal");

    const openRegisterBtn = document.getElementById("openRegisterBtn");
    const openLoginBtn = document.getElementById("openLoginBtn");
    const closeRegisterBtn = document.getElementById("closeRegisterBtn");
    const closeLoginBtn = document.getElementById("closeLoginBtn");
    const closeOtpBtn = document.getElementById("closeOtpBtn");
    const closeLoginOtpBtn = document.getElementById("closeLoginOtpBtn");
    const switchToLoginFromRegister = document.getElementById("switchToLoginFromRegister");

    const registerForm = document.getElementById("registerForm");
    const loginForm = document.getElementById("loginForm");
    const verifyOtpBtn = document.getElementById("verifyOtpBtn");
    const verifyLoginOtpBtn = document.getElementById("verifyLoginOtpBtn");

    const registerError = document.getElementById("registerError");
    const loginError = document.getElementById("loginError");
    const otpError = document.getElementById("otpError");
    const loginOtpError = document.getElementById("loginOtpError");

    const otpInput = document.getElementById("otpInput");
    const loginOtpInput = document.getElementById("loginOtpInput");
    const loginIdentifierInput = document.getElementById("loginIdentifier");

    const restaurantNameInput = document.getElementById("restaurantName");
    const ownerNameInput = document.getElementById("ownerName");
    const addressInput = document.getElementById("registerAddress");
    const registerEmailInput = document.getElementById("registerEmail");
    const registerPhoneInput = document.getElementById("registerPhone");
    const registerPasswordInput = document.getElementById("registerPassword");
    const registerConfirmPasswordInput = document.getElementById("registerConfirmPassword");

    const show = m => m.classList.add("show");
    const hide = m => m.classList.remove("show");

    /* OPEN/CLOSE */
    openRegisterBtn.onclick = ()=> show(registerModal);
    openLoginBtn.onclick = ()=> show(loginModal);

    closeRegisterBtn.onclick = ()=> hide(registerModal);
    closeLoginBtn.onclick = ()=> hide(loginModal);
    closeOtpBtn.onclick = ()=> hide(otpModal);
    closeLoginOtpBtn.onclick = ()=> hide(loginOtpModal);

    switchToLoginFromRegister.onclick = ()=>{
      hide(registerModal);
      show(loginModal);
    };

    document.addEventListener("click", (e)=>{
      if(e.target === registerModal) hide(registerModal);
      if(e.target === loginModal) hide(loginModal);
      if(e.target === otpModal) hide(otpModal);
      if(e.target === loginOtpModal) hide(loginOtpModal);
    });

    function showErr(el, msg){
      el.textContent = msg;
      el.style.display = "block";
    }
    function clearErr(el){
      el.textContent = "";
      el.style.display = "none";
    }

    async function postJSON(url, payload){
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload || {})
      });
      const data = await res.json();
      return { ok: res.ok, data };
    }

    let pendingVendorData = null;
    let loginPendingIdentifier = null;

    // 1) REGISTRATION — SEND OTP (email only, role=vendor, purpose=signup)
    registerForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      clearErr(registerError);

      const restaurantName = restaurantNameInput.value.trim();
      const ownerName = ownerNameInput.value.trim();
      const address = addressInput.value.trim();
      const email = registerEmailInput.value.trim().toLowerCase();
      const phone = registerPhoneInput.value.trim();
      const pwd = registerPasswordInput.value.trim();
      const conf = registerConfirmPasswordInput.value.trim();

      if(!restaurantName || !ownerName || !address || !email || !phone || !pwd){
        return showErr(registerError, "Please fill all fields.");
      }
      if(pwd !== conf){
        return showErr(registerError, "Passwords do not match.");
      }

      try {
        const { ok, data } = await postJSON(
          `${API_BASE}/api/vendor/send-otp`,
          { email }
        );

        if(!ok || !data.success){
          return showErr(registerError, data.message || "Failed to send OTP.");
        }

        pendingVendorData = {
          restaurantName,
          ownerName,
          address,
          email,
          phone,
          password: pwd
        };

        hide(registerModal);
        show(otpModal);

      } catch(err){
        console.error(err);
        showErr(registerError, "Network error. Try again.");
      }
    });

    // 2) REGISTRATION — VERIFY OTP + CREATE VENDOR
    verifyOtpBtn.onclick = async ()=>{
      clearErr(otpError);
      const otp = otpInput.value.trim();

      if(!otp) return showErr(otpError, "Enter the OTP.");

      if(!pendingVendorData){
        return showErr(otpError, "Session expired. Please register again.");
      }

      try {
        const verifyRes = await postJSON(
          `${API_BASE}/api/vendor/verify-otp`,
          {
            email: pendingVendorData.email,
            otp: otp
          }
        );

        if(!verifyRes.ok || !verifyRes.data.success){
          return showErr(otpError, verifyRes.data.message || "Invalid OTP.");
        }

        const regRes = await postJSON(
          `${API_BASE}/api/vendors/register`,
          {
            restaurant_name: pendingVendorData.restaurantName,
            owner_name: pendingVendorData.ownerName,
            email: pendingVendorData.email,
            phone: pendingVendorData.phone,
            address: pendingVendorData.address,
            password: pendingVendorData.password
          }
        );

        if(!regRes.ok || !regRes.data.success){
          return showErr(otpError, regRes.data.message || "Vendor registration failed.");
        }

        alert("Vendor registered & verified successfully!");

        const email = pendingVendorData.email;
        pendingVendorData = null;

        hide(otpModal);
        // IMPORTANT: redirect with email (matches vendor_select.html)
        window.location.href = "vendor_select.html?email=" + encodeURIComponent(email);

      } catch(err){
        console.error(err);
        showErr(otpError, "Network error. Try again.");
      }
    };

    // 3) LOGIN — SEND OTP (email or phone)
    loginForm.addEventListener("submit", async (e)=>{
      e.preventDefault();
      clearErr(loginError);

      const identifier = loginIdentifierInput.value.trim();

      if(!identifier){
        return showErr(loginError, "Please enter email or phone.");
      }

      try {
        const { ok, data } = await postJSON(
          `${API_BASE}/api/vendor/login-send-otp`,
          { identifier }
        );

        if(!ok || !data.success){
          return showErr(loginError, data.message || "Failed to send OTP.");
        }

        loginPendingIdentifier = identifier;

        hide(loginModal);
        show(loginOtpModal);

      } catch(err){
        console.error(err);
        showErr(loginError, "Network error. Try again.");
      }
    });

    // 4) LOGIN — VERIFY OTP
    verifyLoginOtpBtn.onclick = async ()=>{
      clearErr(loginOtpError);

      const otp = loginOtpInput.value.trim();
      if(!otp){
        return showErr(loginOtpError, "Enter OTP.");
      }
      if(!loginPendingIdentifier){
        return showErr(loginOtpError, "Session expired. Try again.");
      }

      try {
        const { ok, data } = await postJSON(
          `${API_BASE}/api/vendor/login-verify-otp`,
          {
            identifier: loginPendingIdentifier,
            otp
          }
        );

        if(!ok || !data.success){
          return showErr(loginOtpError, data.message || "Invalid OTP.");
        }

        const vendor = data.vendor || {};
        const email = vendor.email || loginPendingIdentifier;

        alert("Login successful!");

        loginPendingIdentifier = null;

        hide(loginOtpModal);
        // IMPORTANT: again redirect with email
        window.location.href = "vendor_select.html?email=" + encodeURIComponent(email);

      } catch(err){
        console.error(err);
        showErr(loginOtpError, "Network error. Try again.");
      }
    };

  });
  
  </script>

</body>
</html>
