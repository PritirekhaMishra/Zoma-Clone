<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Order Online ‚Äî Nightlife | ZomaClone</title>
<link rel="icon" type="image/png" sizes="512x512" href="Images/logo_512.png">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --accent:#e23744;

  --bg-dark:#050816;
  --text-dark:#ffffff;
  --card-dark:#0f172a;
  --hover-dark:#1e293b;

  --bg-light:#f4f4f8;
  --text-light:#111111;
  --card-light:#ffffff;
  --hover-light:#ececec;
}
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}
body{
  background:var(--bg-dark);
  color:var(--text-dark);
  transition:background .25s,color .25s;
}
body.light{
  background:var(--bg-light);
  color:var(--text-light);
}
.top-bar{
  width:100%;
  padding:16px 40px;
  background:#0b0f1e;
  border-bottom:1px solid #1e293b;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
body.light .top-bar{
  background:#ffffff;
  border-color:#d4d4d4;
}
.brand{
  display:flex;
  align-items:center;
  gap:10px;
}
.brand-logo{
  width:36px;height:36px;border-radius:12px;
  background:linear-gradient(135deg,#ff1769,#ff884b);
  display:flex;align-items:center;justify-content:center;
  font-weight:800;font-size:18px;color:#fff;
}
#themeToggle{
  padding:8px 16px;
  border-radius:999px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-weight:600;
  cursor:pointer;
  font-size:13px;
  transition:.2s;
}
.banner{
  width:100%;
  min-height:220px;
  padding:40px;
  background-image:
    linear-gradient(135deg,rgba(15,23,42,0.92),rgba(15,23,42,0.4)),
    url('Images/club.webp');
  background-size:cover;
  background-position:center;
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
}
.banner-title{
  font-size:32px;
  font-weight:700;
}
.banner-sub{
  margin-top:4px;
  font-size:14px;
  opacity:.85;
}
.container{
  max-width:1200px;
  margin:40px auto;
  padding:0 24px 30px;
  display:grid;
  grid-template-columns:repeat(4,minmax(0,1fr));
  gap:24px;
}
@media(max-width:1024px){
  .container{grid-template-columns:repeat(3,minmax(0,1fr));}
}
@media(max-width:768px){
  .container{grid-template-columns:repeat(2,minmax(0,1fr));}
}
@media(max-width:520px){
  .container{grid-template-columns:1fr;}
}
.card{
  background:var(--card-dark);
  border-radius:16px;
  padding:14px 14px 16px;
  border:1px solid #1f2937;
  cursor:pointer;
  transition:.23s;
}
body.light .card{
  background:var(--card-light);
  border-color:#d4d4d4;
}
.card:hover{
  transform:translateY(-7px);
  background:var(--hover-dark);
  border-color:#fb7185;
}
body.light .card:hover{
  background:var(--hover-light);
}
.card img{
  width:100%;
  height:150px;
  object-fit:cover;
  border-radius:12px;
}
.card-title-row{
  margin-top:10px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:6px;
}
.card h3{
  font-size:15px;
  font-weight:600;
}
.card .rating{
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  background:rgba(34,197,94,.12);
  color:#bbf7d0;
}
.card .loc{
  margin-top:4px;
  font-size:12px;
  opacity:.85;
}
.card .meta{
  margin-top:3px;
  font-size:11px;
  opacity:.75;
}
.status-msg{
  grid-column:1/-1;
  text-align:center;
  font-size:14px;
  opacity:.8;
  margin-top:10px;
}
footer{
  border-top:1px solid #1e293b;
  padding:16px;
  text-align:center;
  font-size:13px;
  color:#aaa;
}
body.light footer{
  border-color:#d4d4d4;
  color:#555;
}
</style>
</head>

<body>

<header class="top-bar">
  <div class="brand">
    <div class="brand-logo">Z</div>
    <div style="display:flex;flex-direction:column;line-height:1.1;">
      <span style="font-size:13px;opacity:.8;">Nightlife</span>
      <strong style="font-size:16px;">Order Online</strong>
    </div>
  </div>

  <button id="themeToggle">‚òÄ Day</button>
</header>

<section class="banner">
  <div class="banner-title">Order from Nightlife Clubs</div>
  <div class="banner-sub">All clubs registered by vendors appear here.</div>
</section>

<main class="container" id="restaurantGrid"></main>

<footer>&copy; 2025 ZomaClone ‚Äî Nightlife Online Ordering</footer>

<script>
const API_URL = "http://127.0.0.1:5001"; // ‚úÖ Make sure this matches your nightlife backend port

const themeBtn = document.getElementById("themeToggle");

function applyThemeFromStorage(){
  const saved = localStorage.getItem("zoma_nightlife_theme") || "dark";
  if(saved === "light"){
    document.body.classList.add("light");
    themeBtn.textContent = "üåô Night";
  } else {
    document.body.classList.remove("light");
    themeBtn.textContent = "‚òÄ Day";
  }
}
themeBtn.addEventListener("click", () => {
  const isLight = document.body.classList.toggle("light");
  localStorage.setItem("zoma_nightlife_theme", isLight ? "light" : "dark");
  themeBtn.textContent = isLight ? "üåô Night" : "‚òÄ Day";
});
applyThemeFromStorage();

// Always return valid image URL
function fullImageUrl(path){
  if(!path || String(path).trim() === ""){
    return "Images/default.jpg"; // ‚úÖ keep a real fallback image in /Images
  }
  path = String(path);
  if(path.startsWith("http")) return path;
  if(path.startsWith("/")) return API_URL + path;
  return API_URL + "/" + path;
}

async function loadClubs(){
  const grid = document.getElementById("restaurantGrid");
  grid.innerHTML = `<div class="status-msg">Loading clubs...</div>`;

  try{
    // ‚úÖ IMPORTANT: Make this match your backend route
    // If your Python route is @app.get("/nightlife/getClubs"), then:
    const res = await fetch(`${API_URL}/nightlife/getClubs`);

    if(!res.ok){
      grid.innerHTML = `<div class="status-msg">Failed to load clubs (HTTP ${res.status}).</div>`;
      return;
    }

    const payload = await res.json();
    console.log("Nightlife clubs payload:", payload); // ‚úÖ check this in console

    // ‚úÖ Handle both:
    // 1) [ {...}, {...} ]
    // 2) { success: true, clubs: [ {...}, {...} ] }
    const clubs = Array.isArray(payload)
      ? payload
      : (payload.clubs || payload.data || []);

    if(!Array.isArray(clubs) || clubs.length === 0){
      grid.innerHTML = `<div class="status-msg">No clubs available.</div>`;
      return;
    }

    grid.innerHTML = "";

    clubs.forEach(club => {
      // ‚úÖ Resolve possible field names from backend
      const clubId = club.club_id || club.id || club.nightlife_id;
      const name = club.club_name || club.name || club.nightlife_name || "Club";
      const loc =
        club.location ||
        club.address ||
        [club.area, club.city].filter(Boolean).join(", ") ||
        "";

      const desc = (club.description || club.tagline || "").trim();
      const shortDesc = desc.length > 40 ? (desc.substring(0, 40) + "...") : desc;

      const imgUrl = fullImageUrl(
        club.image ||
        club.image_url ||
        club.banner_image ||
        club.banner ||
        club.logo
      );

      const card = document.createElement("div");
      card.className = "card";

      card.innerHTML = `
        <img src="${imgUrl}" alt="${name}">
        <div class="card-title-row">
          <h3>${name}</h3>
          <div class="rating">‚≠ê Live</div>
        </div>
        <div class="loc">${loc}</div>
        <div class="meta">${shortDesc}</div>
      `;

      // ‚úÖ Make sure the param name matches what user_night.html expects
      card.addEventListener("click", () => {
        if(!clubId){
          console.warn("Club without ID:", club);
          return;
        }
        window.location.href = "user_night.html?club_id=" + encodeURIComponent(clubId);
      });

      grid.appendChild(card);
    });

  } catch(err){
    console.error("Error loading clubs:", err);
    grid.innerHTML = `<div class="status-msg">Failed to load clubs (network error).</div>`;
  }
}

loadClubs();
</script>


</body>
</html>
